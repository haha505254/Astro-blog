---
title: PostgreSQL 的連線羅生門：當密碼正確卻無法登入
description: 記錄在 WSL2 Docker 環境中 PostgreSQL 認證失敗的除錯過程，以及最終選擇 MariaDB 的策略轉向
pubDate: 2025-08-06
author: Lin
tags: ['PostgreSQL', 'Docker', 'WSL2', 'MariaDB', '資料庫', '環境設定', '除錯經驗']
category: 技術筆記
excerpt: 當確信密碼正確的 PostgreSQL 卻拒絕連線時，這不是技術問題，而是一場環境與工具的哲學對話。最終我選擇了換一條路，而非硬闖
draft: false
---

## 📝 前言

今天在我的 WSL2 開發環境中，一頭撞上了一道透明的牆。我試圖用 DBeaver 連接 Docker 中的 PostgreSQL，卻被 `FATAL: password authentication failed` 的錯誤訊息無情地擋下。

這不是一次普通的拒絕，因為我確信密碼分毫不差。這感覺更像是一種哲學層面的否定：它不是在說你的鑰匙錯了，它是在說它不承認你是鑰匙的主人。

<br />

---

<br />

## 🔴 初始狀況

### 問題描述

一個看似簡單的資料庫連線，卻成了一道無解的謎題。密碼明明正確，連線卻總是失敗。

<br />

### 💡 學到的第一課：PostgreSQL 是個有「內外場」的 VIP 會所

在排除了 Volume 存有舊密碼等常規嫌疑後，一個驚人的事實浮現：從容器內部（`docker exec`）可以直接登入，暢行無阻；但從外部（localhost）則必定失敗。

我終於看懂了它的規則：這個資料庫會所的保全系統 (`pg_hba.conf`) 有兩套標準。對內部會員（local 連線），它無條件信任 (trust)；但對門口的訪客（host 連線），它堅持要對上一個名為 `scram-sha-256` 的秘密握手暗號。而這個暗號，在我的 WSL2 Docker 網路環境下，不知為何總是對不上。

<br />

---

<br />

## 🔄 策略轉變

在多次嘗試教這位固執的保全學習更簡單的握手方式 (md5)，卻引發更多問題後，我意識到，我試圖破解的不是一道鎖，而是一套與我的環境八字不合的保全系統。

與其當個想盡辦法溜進去的駭客，不如當個可以自由選擇俱樂部的顧客。

<br />

### 💡 學到的第二課：別跟「環境」吵架，直接換個風水寶地

開發中最寶貴的資源是時間與心力。當一個工具因為環境因素持續製造摩擦時，執著於「戰勝」它，有時是一種隱性的成本。

我決定不再與這個深層的網路問題纏鬥，而是採取更高效的策略：更換資料庫。

<br />

---

<br />

## ✨ 最終結果與心得

我把 `docker-compose.yml` 裡的 `postgres:16-alpine` 這位高冷的藝術家，換成了 `mariadb:11` 這位熱情好客的店主。在更新了專案的連線設定後，奇蹟發生了。

DBeaver 的連線請求就像遊子歸鄉，暢行無阻。之前所有的錯誤、延遲與不解，瞬間煙消雲散。

<br />

---

<br />

## 🎯 終極解密：最快的路，有時候是換一條路

這次的經驗讓我深刻體會到，一個工具的「理論最佳」不一定等於它在「我這裡最佳」。PostgreSQL 的功能無疑非常強大，但在我的特定開發環境下，它的認證機制成了一個難以跨越的障礙。

這次的解決方案，核心不在於技術上的攻堅，而在於策略上的轉向。它提醒我，一個優秀開發者的價值，不僅在於解決問題的能力，更在於判斷哪些問題「不值得解決」，並迅速找到更平坦的道路前進。