---
title: Playwright 黑畫面奇案：從 Docker 迷霧到 WSL2 真相的除錯之旅
description: 當 AI 助理用 Playwright 截圖卻只得到黑畫面，一場從 Docker 到 WSL2、從 sudo 到系統相依性的深度除錯之旅
pubDate: 2025-07-25
updatedDate: 2025-08-06
author: Lin
tags: ['Playwright', 'WSL2', 'Docker', '自動化測試', '除錯', 'Ubuntu', 'Chrome', 'Headless Browser']
category: 技術筆記
excerpt: Playwright 成功連線卻截出黑畫面？這不是靈異事件，而是一個關於系統架構、權限管理和相依套件的技術偵探故事
draft: false
---

## 📝 前言

今天，我請我的 AI 小助理 Claude 用 Playwright 幫我的羽球論壇專案拍張照，好方便我做視覺調整。聽起來很簡單，對吧？

但 Claude 傳回來的，卻是一張全黑照片。

這個詭異的黑畫面，最終帶我深入理解了 WSL2、Docker、Playwright 的協作架構，以及 sudo 權限的微妙之處。

<br />

---

<br />

## 🖤 黑畫面之謎：看不見的網頁

### 詭異的現象

Claude 再三保證，它確實啟動了瀏覽器、成功連上了 `http://localhost:5173`，甚至用 JavaScript 確認了網頁標題和內容都已載入。

但無論怎麼拍，照片就是一片漆黑。

就像一個攝影師對著滿屋子的人拍照，洗出來的底片卻是空白的。

<br />

### 🤔 發生了什麼？

怪事發生了。瀏覽器回報：
- ✅ 成功連線到 localhost:5173
- ✅ DOM 元素都存在
- ✅ JavaScript 可以讀取內容
- ❌ 截圖是全黑的

<br />

### 💡 學到的第一課：看不見，不代表不存在

這是最詭異的地方：DOM（文件物件模型）是存在的，但「渲染（Rendering）」這個從程式碼變成圖像的過程完全失敗。

瀏覽器就像個靈魂出竅的軀殼，有內涵，但沒有外貌。

<br />

---

<br />

## 🕵️ 走錯的辦案方向：誰是真兇？

### 錯誤的假設

我跟 AI 的第一個反應都是：「兇手肯定在 Docker 裡！」

我的邏輯很直接：
- 我的論壇是用 `docker-compose` 跑起來的
- 那問題自然出在 Docker 容器的環境裡

我甚至讓 AI 制定了一個修改 `Dockerfile` 的宏偉計畫。

<br />

### 💡 學到的第二課：你在哪，不代表你的工具在哪

就在我準備動手時，一個念頭閃過，我向 AI 提出了質疑，而它也立刻修正了方向。

我們都搞錯了最基本的一點：**執行測試的 Playwright，根本不在 Docker 容器裡！**

<br />

### 真實的架構

讓我用攝影棚的比喻來解釋：

- **我的論壇 App（模特兒）**：在 Docker 這個豪華攝影棚裡，燈光、場景一應俱全
- **Playwright MCP 工具（攝影師）**：其實一直都站在攝影棚外的 WSL2 主機上，透過一個小小的窗口（`localhost:5173`）往裡拍照

問題的根源：
> 攝影師的相機螢幕壞了（WSL2 缺少渲染函式庫），他雖然能對焦（連上網頁），卻看不到任何畫面，自然只能拍出黑畫面。

<br />

---

<br />

## 🔐 深入兔子洞：Sudo 的信任遊戲

### 修復嘗試

好了，目標鎖定：修復我 WSL2 主機上的 Playwright！

AI 給了指令：
```bash
sudo npx playwright install-deps chromium
```

我心想，加個 `sudo`，權力開到最大，肯定沒問題。

<br />

### 意外的失敗連環

結果一連串的失敗：

```bash
# 嘗試 1：總管不認識我的私人工具
sudo npx playwright install-deps chromium
# 錯誤：npx: command not found

# 嘗試 2：總管拿起了工具，卻發現沒電池
sudo $(which npx) playwright install-deps chromium
# 錯誤：node: No such file or directory

# 嘗試 3：總管說他有權力拒絕使用我的私人工具
sudo -E npx playwright install-deps chromium
# 錯誤：npx: command not found
```

我差點把鍵盤砸了。

<br />

### 意外的成功

最後，在我幾乎放棄，直接執行**不加 `sudo`** 的指令時：

```bash
npx playwright install-deps chromium
```

突然就成功了！

<br />

### 💡 學到的第三課：別急著當總管，讓專業的來

我終於明白，Playwright 這個腳本本身就是個聰明的專業人士。

它的工作流程：
1. 以普通使用者身分啟動
2. 檢查需要安裝的系統套件
3. **主動且有禮貌地向系統要求 `sudo` 權限**
4. 只在需要的時候使用高權限

我之前的作法，等於是直接讓一個不懂前端的大老闆（`sudo`）去強行指揮整個工程，他自然連工具在哪都找不到。

正確的做法：讓專案經理（`npx`）自己去調度，他會在需要時自己去向大老闆申請權限。

<br />

---

<br />

## 📺 我的開發環境是個電視台

### 環境架構的頓悟

今天這趟從黑畫面開始的奇幻旅程，最終讓我徹底搞懂了自己每天在用的環境，這個「科技套娃」的真實面貌。

<br />

### 💡 學到的第四課：我的高科技開發電視台

如果用一句話總結我現在的環境：

> 「我在 **Windows 11** 這棟電視台大樓裡，使用 **WSL2** 這套中央控制系統，運行著我的 **Ubuntu** 主控室。而我的論壇應用程式，則是在由 **Docker** 搭建的、完全隔音的**一號攝影棚**裡進行直播。我（和我的 AI 助理 Claude）則坐在主控室裡，透過 Playwright 這台攝影機，監看並操作著攝影棚內的節目。」

<br />

### 架構視覺化

```
Windows 11（電視台大樓）
    └── WSL2（中央控制系統）
        ├── Ubuntu（主控室）
        │   ├── Playwright（攝影機）
        │   └── Claude MCP（AI 導播）
        └── Docker（攝影棚管理）
            └── 論壇 App（一號攝影棚）
                └── localhost:5173（對外窗口）
```

所以，當攝影機的監看螢幕（Playwright on WSL2）壞掉時，去修理攝影棚（Docker）裡的燈光是沒用的。

我們得把主控室裡的螢幕（WSL2 的相依套件）修好才行。

<br />

---

<br />

## 🛠️ 解決方案與最佳實踐

### 完整的修復步驟

```bash
# 1. 不要用 sudo！讓 Playwright 自己處理權限
npx playwright install-deps chromium

# 2. 如果需要，安裝額外的渲染相依套件
sudo apt-get update
sudo apt-get install -y \
    libgbm1 \
    libxkbcommon0 \
    libxss1 \
    libgtk-3-0 \
    libnspr4 \
    libnss3 \
    libasound2

# 3. 確認 Playwright 瀏覽器已安裝
npx playwright install chromium
```

<br />

### 除錯檢查清單

當遇到 Headless 瀏覽器問題時：

1. **確認執行環境** - Playwright 在哪裡執行？
2. **檢查連線** - 能否存取目標 URL？
3. **驗證 DOM** - 元素是否存在？
4. **測試渲染** - 視覺輸出是否正常？
5. **檢查相依套件** - 系統函式庫是否完整？

<br />

---

<br />

## 📚 總結與心得

從一張黑色照片，到理解 `sudo` 的信任機制，再到最後看清整個開發環境的協作架構。

### 重點整理

1. **問題不一定在看得見的地方** - Docker 在跑不代表問題在 Docker
2. **權限管理有其智慧** - 不是所有事都需要 sudo
3. **工具會自己處理權限** - 相信專業工具的設計
4. **理解架構才能有效除錯** - 知道每個組件在哪裡運行

### 給開發者的建議

- 遇到詭異問題時，先確認基本架構
- 不要急著用最高權限解決問題
- 理解工具的設計哲學，而非強行控制
- 最棘手的 Bug，往往能帶來最深刻的學習

有時候，最棘手的 Bug，反而能帶你看到最底層的風景。

<br />

---

<br />

*如果你也曾遇過類似的「靈異」技術問題，歡迎分享你的除錯冒險故事！*